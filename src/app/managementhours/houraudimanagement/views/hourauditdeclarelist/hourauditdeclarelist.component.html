<div class="container-fluid">
    <div class="page-header">
        <h3 class="page-title">学时管理
            <small>| 学时申报审核列表</small>
        </h3>
    </div>
</div>
<div class="hour-audit-list-box">
    <div class="form-list-box">
        <div class="select-body">
            <nz-spin [nzSpinning]="spinning" [nzTip]="'正在读取数据...'">
                <cui-data-table #tableHandle [columns]="departId ? columnsOther: columns" [data]="testListData?.content" [pagination]="testListData"
                    selectType="checkbox" [(selection)]="selection" (reload)="loadData($event)">
                    <ng-template #simpleSearch>
                        <ng-container>
                            <form nz-form [formGroup]="_searchForm" (ngSubmit)="_submitForm($event, _searchForm.value)" [nzLayout]="'inline'" class="cui-data-table-form-box">
                                <div nz-row class="cui-data-table-form-body">
                                    <div nz-form-control>
                                        <nz-input formControlName="trainName" [nzPlaceHolder]="'请输入培训名称'"></nz-input>
                                    </div>
                                    <div class='simple-search-bar-search-box'>
                                        <button type="submit" nz-button [nzType]="'primary'" class='search-btn'>
                                            <i class="fa fa-search"></i>查询
                                        </button>
                                        <button type="button" class="btn btn-link" (click)="tableHandle.isComplexSearch=true">高级查询</button>
                                    </div>
                                </div>
                            </form>
                        </ng-container>
                    </ng-template>

                    <ng-template #complexSearch>
                        <ng-container>
                            <form nz-form [formGroup]="_searchForm" (ngSubmit)="_submitForm($event, _searchForm.value)" [nzLayout]="'horizontal'" class="cui-data-table-form-box">
                                <div nz-row class="cui-data-table-form-body">
                                    <!-- <div nz-col [nzSpan]="8" class="cui-data-table-form-row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="6">
                                                <label for="trainName">培训名称</label>
                                            </div>
                                            <div nz-col [nzSpan]="10">
                                                <nz-input formControlName="trainName" [nzPlaceHolder]="'请输入培训名称'"></nz-input>
                                            </div>
                                        </div>
                                    </div>

                                    <div nz-col [nzSpan]="8" class="cui-data-table-form-row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="6">
                                                <label for="periodTrainingTheme">培训主题</label>
                                            </div>
                                            <div nz-col [nzSpan]="10">
                                                <nz-cascader formControlName="periodTrainingTheme" [nzPlaceHolder]="'请选择培训主题'" (nzLoad)="loadTrainThemeData($event)">
                                                </nz-cascader>
                                            </div>
                                        </div>
                                    </div>

                                    <div nz-col [nzSpan]="8" class="cui-data-table-form-row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="6">
                                                <label for="trainWey">培训方式</label>
                                            </div>
                                            <div nz-col [nzSpan]="10">
                                                <nz-cascader formControlName="trainWey" [nzPlaceHolder]="'请选择培训方式'" (nzLoad)="loadTrainWayData($event)">
                                                </nz-cascader>
                                            </div>
                                        </div>
                                    </div>

                                    <div nz-col [nzSpan]="8" class="cui-data-table-form-row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="6">
                                                <label for="trainType">培训类型</label>
                                            </div>
                                            <div nz-col [nzSpan]="10">
                                                <nz-cascader formControlName="trainType" [nzPlaceHolder]="'请选择培训类型'" (ngModelChange)="_console($event)" (nzChange)="_console($event)"
                                                    (nzLoad)="loadTrainTypeData($event)">
                                                </nz-cascader>
                                            </div>
                                        </div>
                                    </div>
                                    <div nz-col [nzSpan]="8" class="cui-data-table-form-row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="6">
                                                <label>开始时间</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="18">
                                                <nz-datepicker formControlName="startDate" [nzPlaceHolder]="'请选择日期'"></nz-datepicker>

                                            </div>
                                        </div>
                                    </div>
                                    <div nz-col [nzSpan]="8" class="cui-data-table-form-row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="6">
                                                <label>结束时间</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="18">
                                                <nz-datepicker formControlName="endDate" [nzPlaceHolder]="'请选择日期'"></nz-datepicker>

                                            </div>
                                        </div>
                                    </div> -->

                                    <div nz-col [nzSpan]="8" class="cui-data-table-form-row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="6">
                                                <label>用户名</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="10">
                                                <nz-input formControlName="username" [nzPlaceHolder]="'请输入用户名'"></nz-input>

                                            </div>
                                        </div>
                                    </div>

                                    <div nz-col [nzSpan]="8" class="cui-data-table-form-row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="6">
                                                <label>姓名</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="10">
                                                <nz-input formControlName="displayName" [nzPlaceHolder]="'请输入姓名'"></nz-input>

                                            </div>
                                        </div>
                                    </div>

                                    <div nz-col [nzSpan]="8" class="cui-data-table-form-row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="6">
                                                <label>申报人</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="10">
                                                <nz-input formControlName="declareUserName" [nzPlaceHolder]="'请输入申报人'"></nz-input>

                                            </div>
                                        </div>
                                    </div>

                                    <div nz-col [nzSpan]="8" class="cui-data-table-form-row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="6">
                                                <label>提交状态</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="10">
                                                <!-- <nz-input formControlName="isSubmit" [nzPlaceHolder]="'请输入姓名'"></nz-input> -->
                                                <nz-select [nzPlaceHolder]="'请选择提交状态'" formControlName="isSubmit" nzAllowClear [nzShowSearch]="true">
                                                    <nz-option [nzLabel]="'全部'" [nzValue]="''">
                                                    </nz-option>
                                                    <nz-option [nzLabel]="'未提交'" [nzValue]="'false'">
                                                    </nz-option>
                                                    <nz-option [nzLabel]="'已提交'" [nzValue]="true">
                                                    </nz-option>
                                                </nz-select>
                                            </div>
                                        </div>
                                    </div>

                                    <div nz-col [nzSpan]="8" class="cui-data-table-form-row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="6">
                                                <label>审核状态</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="10">
                                                <!-- <nz-input formControlName="isSubmit" [nzPlaceHolder]="'请输入姓名'"></nz-input> -->
                                                <nz-select [nzPlaceHolder]="'请选择审核状态'" formControlName="status" nzAllowClear [nzShowSearch]="true">
                                                    <nz-option [nzLabel]="'全部'" [nzValue]="''">
                                                    </nz-option>
                                                    <nz-option [nzLabel]="'已通过'" [nzValue]="'P'">
                                                    </nz-option>
                                                    <nz-option [nzLabel]="'待审核'" [nzValue]="'M'">
                                                    </nz-option>
                                                    <nz-option [nzLabel]="'已拒绝'" [nzValue]="'R'">
                                                    </nz-option>
                                                </nz-select>
                                            </div>
                                        </div>
                                    </div>

                                    <div nz-col [nzSpan]="8" class="cui-data-table-form-row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="6">
                                                <label>所属组织</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="10">
                                                <!-- <nz-input formControlName="isSubmit" [nzPlaceHolder]="'请输入姓名'"></nz-input> -->
                                                <spk-user-group-select mode="multiple" formControlName="ownProjectGroup"></spk-user-group-select>
                                            </div>
                                        </div>
                                    </div>


                                    <div class="cui-data-table-form-row">
                                        <div class='complex-search-bar-search-box'>
                                            <button nz-button [nzType]="'primary'" [nzSize]="'large'" class='search-btn'>
                                                <i class="fa fa-search"></i>查询
                                            </button>
                                            <button type="button" class="btn btn-link" (click)="tableHandle.isComplexSearch=false">简单查询
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </ng-container>
                    </ng-template>
                    <ng-template #listTools>
                        <div *ngIf="departId">
                            <button *spkAuthzIf="{hasPermission: 'PERIOD:AUDIT '}" nz-button [nzType]="'primary'" (click)="batchrefuse($event)">
                                <i style="font-size:14px;top:4px;" class="iconfont icon-weibiaoti525"></i> 批量审核</button>
                            <button *spkAuthzIf="{hasPermission: 'PERIOD:DECLARE_OTHER:VIEW'}" [title]="testListData&&testListData.content.length==0?'无数据不可导':''"
                                [disabled]="testListData&&testListData.content.length==0" (click)="exporthour($event)" nz-button
                                [nzType]="'primary'">
                                <i class="iconfont icon-daochu"></i> 导出</button>
                            <button [routerLink]="['../../']" [nzType]="'primary'" nz-button>
                                <i class="iconfont icon-fanhui1"></i>返回</button>
                        </div>
                        <div *ngIf="!departId">
                            <button *spkAuthzIf="{hasPermission: 'PERIOD:AUDIT '}" nz-button [nzType]="'primary'" (click)="mutipleUpdate()">
                                <i class="iconfont icon-gengxin"></i> 批量更新
                            </button>
                            <button *spkAuthzIf="{hasPermission: 'PERIOD:DECLARE_OTHER:ADD'}" [disabled]="!judgeImportantAdd" [title]="!judgeImportantAdd?'学时不可录入':''"
                                nz-button [nzType]="'primary'" (click)="batchimport($event)">
                                <i style="font-size:14px;top:4px;" class="iconfont icon-daoru1"></i> 批量导入</button>
                            <button *spkAuthzIf="{hasPermission: 'PERIOD:AUDIT '}" nz-button [nzType]="'primary'" (click)="batchrefuse($event)">
                                <i style="font-size:14px;top:4px;" class="iconfont icon-weibiaoti525"></i> 批量审核</button>
                            <button *spkAuthzIf="{hasPermission: 'PERIOD:DECLARE_OTHER:ADD'}" [disabled]="!judgeImportantAdd" [title]="!judgeImportantAdd?'学时不可录入':''"
                                nz-button [nzType]="'primary'" (click)="addtrainhour($event)">
                                <i style="font-size:14px" class="iconfont icon-tianjia"></i> 添加</button>
                            <button *spkAuthzIf="{hasPermission: 'PERIOD:DECLARE_OTHER:EDIT'}" nz-button [nzType]="'primary'" (click)="periodsubmit()">
                                <i class="iconfont icon-tijiao1"></i> 提交</button>
                            <button *spkAuthzIf="{hasPermission: 'PERIOD:DECLARE_OTHER:VIEW'}" [title]="testListData&&testListData.content.length==0?'无数据不可导':''"
                                [disabled]="testListData&&testListData.content.length==0" (click)="exporthour($event)" nz-button
                                [nzType]="'primary'">
                                <i class="iconfont icon-daochu"></i> 导出</button>
                            <button *spkAuthzIf="{hasPermission: 'PERIOD:DECLARE_OTHER:REMOVE'}" (click)="delete($event)" nz-button [nzType]="'primary'">
                                <i class="iconfont icon-shanchu"></i> 删除</button>
                        </div>
                    </ng-template>
                    <ng-template cuiColTpl="actions" let-row="row">
                        <span *ngIf="!departId">
                            <span *spkAuthzIf="{hasPermission: 'PERIOD:DECLARE_OTHER:EDIT'}">
                                <i *ngIf="row.status=='N'" title="编辑" style="cursor: pointer;color:#007bff;font-size:16px" (click)="todeclartionedit(row.id)"
                                    class="iconfont icon-bianji-copy"></i>
                            </span>
                            <i *ngIf="row.status=='P'" title="已提交不可编辑" style="cursor:pointer;color:#aaa" class="iconfont icon-bianji-copy"></i>
                        </span>
                        <i style="color:#aaa;font-size:18px" *ngIf="row.status=='P'" title="审核已通过无需再审核" class="iconfont icon-weibiaoti525"></i>
                        <i style="color:#aaa;font-size:18px" *ngIf="row.status=='N'" title="请先提交后再进行审核" class="iconfont icon-weibiaoti525"></i>
                        <span *spkAuthzIf="{hasPermission: 'PERIOD:AUDIT '}">
                            <i *ngIf="row.status=='M'" style="color:red;font-size:18px;cursor: pointer" title="审核" (click)="toexamine(row.id)" class="iconfont icon-weibiaoti525"></i>
                        </span>
                    </ng-template>
                    <ng-template cuiColTpl="username" let-row="row">
                        <span>{{row.user?.username }}</span>
                    </ng-template>
                    <ng-template cuiColTpl="displayName" let-row="row">
                        <span>{{row.user?.displayName}}</span>
                    </ng-template>
                    <ng-template cuiColTpl="userGroupNamePath" let-row="row">
                        <span>{{getUserGroup(row.user.userGroup?.namePath)}}</span>
                    </ng-template>
                    <ng-template cuiColTpl="declareUserName" let-row="row">
                        <span>{{row.user?.username}}</span>
                    </ng-template>
                    <ng-template cuiColTpl="declaredisPlayName" let-row="row">
                        <span>{{row.user?.displayName}}</span>
                    </ng-template>
                    <ng-template cuiColTpl="startDate" let-row="row">
                        <span>{{row.startDate | date:'yyyy-MM-dd'}}</span>
                    </ng-template>
                    <ng-template cuiColTpl="endDate" let-row="row">
                        <span>{{row.endDate | date:'yyyy-MM-dd'}}</span>
                    </ng-template>
                    <ng-template cuiColTpl="trainName" let-row="row">
                        <span>{{row.trainName}}</span>
                    </ng-template>
                    <ng-template cuiColTpl="trainContent" let-row="row">
                        <span style="display:block;text-align:left;">{{row.trainContent}}</span>
                    </ng-template>
                    <ng-template cuiColTpl="periodTrainingTheme" let-row="row">
                        <span style="display:block;text-align:left;">{{row.periodTrainingTheme.name}}</span>
                    </ng-template>
                    <ng-template cuiColTpl="periodTrainingType" let-row="row">
                        <span style="display:block;text-align:left;">{{row.periodTrainingType.name}}</span>
                    </ng-template>
                    <ng-template cuiColTpl="periodTrainingWey" let-row="row">
                        {{row.periodTrainingWey.name}}
                    </ng-template>
                    <ng-template cuiColTpl="trainDays" let-row="row">
                        <span>{{row.trainDays }}</span>
                    </ng-template>
                    <ng-template cuiColTpl="periodNumber" let-row="row">
                        <span>{{row.periodNumber}}</span>
                    </ng-template>
                    <ng-template cuiColTpl="approveUser" let-row="row">
                        <span>{{row.approveUser}}</span>
                    </ng-template>
                    <ng-template cuiColTpl="approveInfo" let-row="row">
                        <span>{{row.approveInfo}}</span>
                    </ng-template>
                    <ng-template cuiColTpl="isSubmit" let-row="row">
                        <span *ngIf="!row.isSubmit" style="color:red;">未提交</span>
                        <span *ngIf="row.isSubmit" style="color:green">已提交</span>
                    </ng-template>
                    <ng-template cuiColTpl="status" let-row="row">
                        <span *ngIf="row.status=='N'" style="color:red;"></span>
                        <span *ngIf="row.status=='P'" style="color:green">已通过</span>
                        <span *ngIf="row.status=='M'" style="color:green">待审核</span>
                        <span *ngIf="row.status=='R'" style="color:red">已拒绝</span>
                    </ng-template>
                    <ng-template cuiColTpl="username" let-row="row">
                        <span>{{row?.user?.username}}</span>
                    </ng-template>
                    <ng-template cuiColTpl="displayName" let-row="row">
                        <span>{{row?.user?.displayName}}</span>
                    </ng-template>
                    <ng-template cuiColTpl="userGroup" let-row="row">
                        <span>{{getUserGroup(row?.user?.userGroup?.namePath)}}</span>
                    </ng-template>
                </cui-data-table>
            </nz-spin>
        </div>
    </div>
</div>
<!-- 批量更新 -->
<nz-modal class="update-modal-show" *ngIf="isVisible" [nzZIndex]="1002" [nzVisible]="isVisible" [nzWidth]="1000" [nzFooter]="false"
    [nzTitle]="'批量更新'" [nzContent]="modalContent" (nzOnCancel)="handleCancel($event)">
    <ng-template #modalContent>
        <div class="form-name-box">
            <nz-spin [nzTip]="'正在读取数据...'" [nzSpinning]="spinningUpdate">
                <form nz-form [formGroup]="_form" class="form-horizontal" (ngSubmit)="_saveformmessage($event,_form.value)">
                    <div class="card">
                        <div class="card-body">
                            <!-- <h5 class="card-title">其他信息</h5> -->
                            <div class="row">
                                <div class="col-6 push-6 order-1">
                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>培训名称</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14">
                                                <nz-input [nzPlaceHolder]="'请输培训名称'" type="text" name="trainName" class="form-control" formControlName="trainName"></nz-input>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>培训内容</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14" nz-form-control>

                                                <nz-input [nzPlaceHolder]="'请输入培训内容'" type="text" name="trainContent" class="form-control" formControlName="trainContent"></nz-input>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>开始时间</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14">
                                                <nz-datepicker formControlName="startDate" [nzPlaceHolder]="'请选择日期'"></nz-datepicker>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>培训学时</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14" nz-form-control [nzValidateStatus]="_form.controls.periodNumber">
                                                <!-- <nz-input-number [nzMin]="45" [nzMax]="90" [nzStep]="1" name="staffTeacherPeriod" class="form-control" formControlName="staffTeacherPeriod"></nz-input-number> -->
                                                <nz-input [nzPlaceHolder]="'培训学时数'" type="text" name="periodNumber" class="form-control period-number" formControlName="periodNumber"></nz-input>
                                                <div nz-form-explain *ngIf="_form.controls.periodNumber.dirty&&_form.controls.periodNumber.hasError('pattern')">输入无效，请输入数字!</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>培训方式</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14" [nzValidateStatus]="_form.controls['periodTrainingWey']">
                                                <nz-cascader formControlName="periodTrainingWey" [nzPlaceHolder]="'请选择培训方式'" (nzLoad)="loadDataTrainWayUpdate($event)">
                                                </nz-cascader>
                                                <!-- <nz-select formControlName="periodTrainingWey" [nzPlaceHolder]="'请选择培训方式'" nzAllowClear [nzShowSearch]="true">
                                                    <nz-option *ngFor="let option of trainwayData" [nzLabel]="option.name" [nzValue]="option.id">
                                                    </nz-option>
                                                </nz-select> -->

                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>培训地点</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14">
                                                <nz-input [nzPlaceHolder]="'请输入培训地点'" type="text" name="trainPlace" class="form-control" formControlName="trainPlace"></nz-input>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>主办单位</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14">
                                                <nz-input [nzPlaceHolder]="'请输入主办单位'" type="text" name="userGroupName" class="form-control" formControlName="userGroupName"></nz-input>
                                                <!-- <spk-user-group-select placeholder="请选择主办单位" [isRegion]="true" formControlName="userGroup"></spk-user-group-select> -->
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>描述</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14">
                                                <textarea rows="3" cols="20" placeholder="请输入描述内容" type="textarea" name="remark" class="form-control textarea-control" formControlName="remark">
                                                        </textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6 pull-6 order-2">
                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>培训主题</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14">
                                                <nz-cascader formControlName="periodTrainingTheme" [nzPlaceHolder]="'请选择培训主题'" (nzLoad)="loadDataThemeUpdate($event)">
                                                </nz-cascader>
                                                <!-- <nz-select formControlName="periodTrainingTheme" [nzPlaceHolder]="'请选择培训主题'" nzAllowClear [nzShowSearch]="true">
                                                    <nz-option *ngFor="let option of trainthemeData" [nzLabel]="option.name" [nzValue]="option.id">
                                                    </nz-option>
                                                </nz-select> -->

                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>培训天数</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14" [nzValidateStatus]="_form.controls.trainDays">

                                                <nz-input [nzPlaceHolder]="'请输入天数'" type="text" name="trainDays" class="form-control" formControlName="trainDays"></nz-input>

                                                <div nz-form-explain *ngIf="_form.controls.trainDays.dirty&&_form.controls.trainDays.hasError('pattern')">输入无效，请输入数字!</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>结束时间</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14">
                                                <nz-datepicker formControlName="endDate" [nzPlaceHolder]="'请选择日期'"></nz-datepicker>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>培训类型</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14">
                                                <!-- 三级联动 -->
                                                <nz-cascader formControlName="periodTrainingType" [nzPlaceHolder]="'请选择培训分类'" (ngModelChange)="_console($event)" (nzChange)="_console($event)"
                                                    (nzLoad)="loadDataUpdate($event)">
                                                </nz-cascader>

                                            </div>
                                        </div>
                                    </div>
                                    <!-- <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>培训人数</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14" [nzValidateStatus]="_form.controls.trainPeople">

                                                <nz-input [nzPlaceHolder]="'请输入人数'" type="text" name="trainPeople" class="form-control" formControlName="trainPeople"></nz-input>

                                                <div nz-form-explain *ngIf="_form.controls.trainPeople.dirty&&_form.controls.trainPeople.hasError('pattern')">输入无效，请输入数字!</div>
                                            </div>
                                        </div>
                                    </div> -->


                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>培训形式</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14">
                                                <nz-select nzAllowClear (ngModelChange)="_consoletrainForm($event)" formControlName="trainForm" [nzPlaceHolder]="'请选择培训形式'"
                                                    [nzShowSearch]="true">
                                                    <nz-option [nzLabel]="'面授'" [nzValue]="'FACE_TO_FACE'">
                                                    </nz-option>
                                                    <nz-option [nzLabel]="'在线'" [nzValue]="'ONLINE'">
                                                    </nz-option>
                                                    <nz-option [nzLabel]="'混合'" [nzValue]="'BLEND'">
                                                    </nz-option>
                                                    <nz-option [nzLabel]="'其他'" [nzValue]="'OTHER'">
                                                    </nz-option>
                                                </nz-select>
                                            </div>
                                        </div>
                                    </div>

                                    <div *ngIf="trainFormDes" class="fprm-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>培训形式描述</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14">
                                                <textarea rows="3" cols="20" placeholder="请输入描述内容" type="textarea" name="otherTypeDescription" class="form-control" formControlName="otherTypeDescription">
                                                            </textarea>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>培训来源</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14">
                                                <nz-cascader formControlName="periodTrainingSource" [nzPlaceHolder]="'请选择培训来源'" (nzLoad)="loadDataSourceUpdate($event)">
                                                </nz-cascader>
                                                <!-- <nz-select formControlName="periodTrainingSource" [nzPlaceHolder]="'请选择培训来源'" nzAllowClear [nzShowSearch]="true">
                                                    <nz-option *ngFor="let option of trainsourceData" [nzLabel]="option.name" [nzValue]="option.id">
                                                    </nz-option>
                                                </nz-select> -->

                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>收费方式</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14" [nzValidateStatus]="_form.controls.isInvolveCost">
                                                <nz-select nzAllowClear (ngModelChange)="_consoleisInvolveCost($event)" formControlName="isInvolveCost" [nzPlaceHolder]="'请选择收费方式'"
                                                    [nzShowSearch]="true">
                                                    <nz-option [nzLabel]="'收费'" [nzValue]="1">
                                                    </nz-option>
                                                    <nz-option [nzLabel]="'免费'" [nzValue]="0">
                                                    </nz-option>
                                                </nz-select>
                                            </div>
                                        </div>
                                    </div>
                                    <div *ngIf="isFreeCost" class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label>费用</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14">
                                                <nz-input-number formControlName="cost" [nzMin]="1" [nzMax]="999999999" [nzStep]="1"></nz-input-number>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-form-label nz-col [nzSpan]="8">
                                                <label for="">上传附件</label>
                                            </div>
                                            <div nz-form-control nz-col [nzSpan]="14">
                                                <cui-fileupload accept="image/*,application/zip,application/vnd.ms-powerpoint,application/msword,application/vnd.ms-excel,text/*"
                                                    mode="file" name="file" url="/api/upload/file" [auto]="true" [multiple]="true"
                                                    (uploadComplete)="onFileUpload($event)" class="upload-file"></cui-fileupload>
                                                <!-- <a href="javascript:;" class="file-upload">选择文件
                                                        <input name="files" id="fileId" #fileId (change)="changeuploadfile($event)" type="file" accept="image/*,application/zip,application/vnd.ms-powerpoint,application/msword,application/vnd.ms-excel,text/*">
                                                    </a>
                                                    <span *ngIf="uploadfilename" class="file-name">
                                                        <i (click)="removefile()" title="删除文件" class="anticon anticon-close-circle-o"></i> {{uploadfilename}}</span> -->
                                                <ul *ngIf="files.length" class="file-list-upload">
                                                    <li *ngFor="let item of files" class="file-item upload-success">
                                                        <span class="show-item">
                                                            <strong>{{item.originFileName}}</strong>
                                                        </span>
                                                        <span></span>
                                                        <div class="progress" style="height: 3px;">
                                                            <div class="progress-bar progress-bar-striped bg-success" style="width: 100%;"></div>
                                                        </div>
                                                        <span (click)="removeUploadfile(item.relativePath)" class="item-remove">✕</span>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-7">
                                    <div class="form-group row">
                                        <div nz-form-item nz-row>
                                            <div nz-col [nzOffset]="18" [nzSpan]="10" nz-form-control>
                                                <button [disabled]="_form.invalid" [nzLoading]="btnstate" nz-button [nzType]="'primary'">保存</button>
                                                <span (click)="goBack()" class="cancel-btn">取消</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </nz-spin>
        </div>
    </ng-template>
</nz-modal>


<nz-modal class="refuse-modal" [nzZIndex]="1002" [nzFooter]="false" *ngIf="isVisibleRefuse" [nzVisible]="isVisibleRefuse"
    [nzTitle]="'审核意见'" [nzContent]="modalContent" (nzOnCancel)="handleCancelRefuse($event)" (nzOnOk)="handleOkRefuse($event)">
    <ng-template #modalContent>
        <textarea placeholder="请输入审批意见！" [(ngModel)]="textcontent" name="textvalue" id="review" cols="30" rows="6"></textarea>
        <div class="opear-btn">
            <button *spkAuthzIf="{hasPermission: 'PERIOD:AUDIT:SECOND'}" [nzLoading]="cpbtnstate" (click)="chooseUserPass()" nz-button
                [nzType]="'primary'">
                <span>通过</span>
            </button>
            <button *spkAuthzIf="{hasPermission: 'PERIOD:AUDIT:SECOND'}" [nzLoading]="crbtnstate" (click)="chooseUserRefuse()" nz-button
                [nzType]="'primary'">
                <span>拒绝</span>
            </button>
        </div>
    </ng-template>
</nz-modal>